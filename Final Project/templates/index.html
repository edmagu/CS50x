<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>OrganizeMyMusic â€“ Smart Music Organizer</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="bg-dark text-light">
  <nav class="navbar navbar-dark bg-gradient bg-opacity-75 shadow-sm px-3">
    <a class="navbar-brand fw-bold" href="#">ðŸŽ§ OrganizeMyMusic</a>
  </nav>

  <div class="container text-center mt-5">
    <h1 class="display-5 fw-bold mb-3">Smart Music Organizer</h1>
    <p class="lead mb-5">Upload your tracks â€” drag & drop or select â€” and OrganizeMyMusic will organize them by genre automatically.</p>

    <form id="upload-form" action="/upload" method="post" enctype="multipart/form-data"
      class="p-5 bg-dark rounded-4 shadow-lg border border-secondary position-relative">

      <!-- Drag & Drop Zone -->
      <div id="drop-zone" class="p-5 rounded-4 border border-dashed border-secondary text-center">
        <i class="bi bi-cloud-arrow-up display-1 text-primary mb-3"></i>
        <p class="fs-5 text-secondary">Drag & drop your music files here</p>
        <p class="text-secondary">or</p>
        <input type="file" id="file-input" name="files[]" multiple accept=".mp3,.wav" class="form-control form-control-lg mt-2" />
      </div>

      <!-- Upload Progress -->
      <div class="progress mt-4 d-none" id="upload-progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" role="progressbar"
          style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>

      <!-- Upload Button -->
      <button type="submit" id="upload-btn" class="btn btn-primary btn-lg mt-4 px-4">
        <i class="bi bi-music-note-beamed me-2"></i> Upload & Organize
      </button>
    </form>
  </div>

  <footer class="text-center text-secondary mt-5 small">
    <p>Made with frustration using Flask & Mutagen</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const form = document.getElementById('upload-form');
    const progressContainer = document.getElementById('upload-progress');
    const progressBar = progressContainer.querySelector('.progress-bar');

    // Highlight drag area
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    // Handle drop
    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      fileInput.files = e.dataTransfer.files;
    });

    // AJAX upload with progress
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const xhr = new XMLHttpRequest();

      progressContainer.classList.remove('d-none');
      progressBar.style.width = '0%';

      xhr.upload.addEventListener('progress', (e) => {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          progressBar.style.width = percent.toFixed(0) + '%';
          progressBar.setAttribute('aria-valuenow', percent.toFixed(0));
        }
      });

      xhr.onload = () => {
        if (xhr.status === 200) {
          window.location.href = '/results';
        } else {
          alert('Upload failed. Please try again.');
        }
      };

      xhr.open('POST', '/upload');
      xhr.send(formData);
    });
  </script>
</body>
</html>
